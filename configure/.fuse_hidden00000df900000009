#!/bin/bash  

cache=https://raw.github.com/rvaronos/code-gathering/master/configure/
conf=/root/.gconf/apps/gnome-terminal/
search=Profile
max=0

indexOf(){
return | awk -v a="$1" -v b="$2" 'BEGIN{print index(a,b)}'
}
substr(){
return | awk -v s="$1" -v a="$2" 'BEGIN{print substr(s,a)}'
}

cd ~/.cache
mkdir -p code-gathering
cd ./code-gathering 

echo ${conf}profiles

#sudo mkdir -p ${conf}profiles
#sudo mkdir -p ${conf}global

# Look into directory for subdirectories (-type d) with name strting in 'Profile'
list=$(sudo find profiles -type d -name $search* )

for i in $list
do

cd $i
index=$(substr $i $(($(indexOf $i $search)+${#search})))

if [ grep "CodeGathering" %gconf.xml ]
then
echo "CodeGathering Profile already exists"
return
fi

if [ $index > $max ] 
then 
$max=$index
fi

done;

line="<li type=\"string\">\n<stringvalue>Profile${max+1}</stringvalue>\n</li>"

sed "34i ${line}" ${conf}global/%gconf.xml > newfile

echo $line

wget -N ${cache}packages ${cache}script.sh ${cache}profile.xml

sudo cp profile.xml ${profile}%gconf.xml
sudo gnome-terminal --window-with-profile=CodeGathering -e "sh script.sh $USER"

