#!/bin/bash

sep="----------------------"
iwd=${PWD}

initOptions(){

get(){
if [ -f $2 ]
then
echo "${2} exists.. aborting"
return
fi
curl -# ${1}/${2} > ${2}
}

clearAllCache(){
rm -rf ~/.cache/code-gathering/*
echo "Cache cleared"
getOption
}

initProject(){

base=https://raw.github.com/rvaronos/code-gathering/master/terminal
projects=()

read -r LINE_ARRAY <<< "$(curl -# ${base}/projects/list)"

IFS=";" 

for x in "${LINE_ARRAY[@]}"
do

local i=0

read -ra STR_ARRAY <<< "$x"
printf "\n[%1d] : %5s - %20s" ${i} ${STR_ARRAY[0]} ${STR_ARRAY[1]}
projects[${i}]=${STR_ARRAY[0]}

((i++))

done

printf "\n\n"

echo -n "Enter project's index: "
read -s -n1 index
project=${projects[$index]}
printf "\rSelected project: ${project}\n"

# Get the cache folder ready
cd ~/.cache/
mkdir -p code-gathering
cd code-gathering

get ${base}/tools string
get ${base}/tools profile

#************************************************************************
# Start gnome terminal with the script specified running custom Profile
#************************************************************************

source profile
source string

checkProfile CodeGathering

mkdir -p ${project}
cd ${project}
get ${base}/projects/${project} main
get ${base}/tools constructor

gnome-terminal --tab-with-profile=CodeGathering --command="bash main ${project}"
}

clear;

addOptions(){
local i=1
for option in "$@"
do
echo "[${i}] ${option}"
((i++))
done
}

exitOptions(){
echo "To start again, type: initOptions"
}

echo -e "${sep}\nChoose an option:\n${sep}"
addOptions "Initialise Project" "Clear all cache" "Exit"
echo ${sep}

getOption(){
read -s -n1 ans
${optionFunc[$(( $ans - 1 ))]}
}

option(){
optionFunc=(${@} getOption)
getOption
}

option initProject clearAllCache exitOptions

}
initOptions
# Go back to initial working directory
cd "${iwd}"









